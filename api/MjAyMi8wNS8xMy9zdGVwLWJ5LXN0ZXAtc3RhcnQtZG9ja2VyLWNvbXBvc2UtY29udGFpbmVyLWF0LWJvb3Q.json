{"title":"A step by step how to start docker-compose container at boot","date":"2022-05-12T16:00:00.000Z","date_formatted":{"ll":"May 13, 2022","L":"05/13/2022","MM-DD":"05-13"},"thumbnail":"https://miro.medium.com/max/720/0*Lg-9-9a8CGboAcaT","link":"2022/05/13/step-by-step-start-docker-compose-container-at-boot","tags":["docker","docker-compose","linux"],"categories":["infra"],"updated":"2022-10-16T16:00:00.000Z","content":"<p>Post in Medium: <a href=\"https://jason19970210.medium.com/a-step-by-step-how-to-start-docker-compose-container-at-boot-effe9964e57f\" target=\"_blank\">https://jason19970210.medium.com/a-step-by-step-how-to-start-docker-compose-container-at-boot-effe9964e57f</a><br>\nOnce create a docker container, we might hope the container can start automatically by itself, at the boot and even reboot.</p>\n<span id=\"more\"></span>\n<p>Here we will go through with <code>docker-compose</code> yaml config file, ex. <code>docker-compose.yml</code> .<br>\nAs the basic yaml file:</p>\n<figure class=\"highlight yaml\"><figcaption><span>docker-compose.yml</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">version:</span> <span class=\"string\">&quot;3&quot;</span></span><br><span class=\"line\"><span class=\"attr\">service:</span></span><br><span class=\"line\">    <span class=\"attr\">restart:</span> <span class=\"string\">always</span> <span class=\"comment\"># the most important line for this post</span></span><br><span class=\"line\">    <span class=\"attr\">image:</span> <span class=\"string\">xxxx</span> <span class=\"comment\">#docker image</span></span><br><span class=\"line\">    <span class=\"attr\">environment:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"attr\">key :</span> <span class=\"string\">value</span> <span class=\"string\">...</span></span><br><span class=\"line\">    <span class=\"attr\">ports:</span></span><br><span class=\"line\">        <span class=\"bullet\">-</span> <span class=\"number\">8080</span><span class=\"string\">:80</span></span><br></pre></td></tr></table></figure>\n<p>Letâ€™s take a look at docker restart policy with 4 types :<br>\nRef : <a href=\"https://docs.docker.com/config/containers/start-containers-automatically/#use-a-restart-policy\" target=\"_blank\">https://docs.docker.com/config/containers/start-containers-automatically/#use-a-restart-policy</a></p>\n<p><code>no</code> : Do not automatically restart the container.  (the <strong>default</strong>)</p>\n<p><code>on-failure[:max-retries]</code> : Restart the container if it exits due to an error, which manifests as a non-zero exit code. Optionally, limit the number of times the Docker daemon attempts to restart the container using the :max-retries option.</p>\n<p><code>always</code> : Always restart the container if it stops. If it is manually stopped, it is restarted only when Docker daemon restarts or the container itself is manually restarted. (See the second bullet listed in restart policy details)</p>\n<p><code>unless-stopped</code> : Similar to always, except that when the container is stopped (manually or otherwise), it is not restarted even after Docker daemon restarts.</p>\n<p>With the basic docker command start a container:<br>\n<code>$ docker run -d --restart &lt;restart_policy&gt; &lt;docker_image&gt;</code></p>\n<p>Please make sure the docker daemon has been enable to launch at boot:</p>\n<figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo systemctl start docker</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo systemctl <span class=\"built_in\">enable</span> docker</span></span><br><span class=\"line\"><span class=\"meta prompt_\">$ </span><span class=\"language-bash\">sudo systemctl is-enabled docker</span> </span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\"># the output should be enabled</span></span></span><br></pre></td></tr></table></figure>\n<p>Check the docker container restart policy<br>\n<code>$ docker inspect &lt;container_id&gt; | fgrep -i restart -A 5</code></p>\n<p>if nothing is set to restart:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;AppArmorProfile&quot;:</span> <span class=\"string\">&quot;docker-default&quot;</span><span class=\"string\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;RestartPolicy&quot;:</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;:</span> <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;MaximumRetryCount&quot;</span><span class=\"string\">:0</span></span><br><span class=\"line\">&#125;<span class=\"string\">,</span></span><br><span class=\"line\"><span class=\"string\">...</span></span><br></pre></td></tr></table></figure>\n<p>Once we set the <code>restart</code> parameter:</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">&quot;AppArmorProfile&quot;:</span> <span class=\"string\">&quot;docker-default&quot;</span><span class=\"string\">,</span></span><br><span class=\"line\"><span class=\"attr\">&quot;RestartPolicy&quot;:</span> &#123;</span><br><span class=\"line\">    <span class=\"attr\">&quot;Name&quot;:</span> <span class=\"string\">&quot;always&quot;</span>,</span><br><span class=\"line\">    <span class=\"string\">&quot;MaximumRetryCount&quot;</span><span class=\"string\">:0</span></span><br><span class=\"line\">&#125;<span class=\"string\">,</span></span><br><span class=\"line\"><span class=\"string\">...</span></span><br></pre></td></tr></table></figure>\n<p>Now the container can restart by itself after the pc/server reboot.<br>\nHope this can help you and save a day off !!</p>\n<p>Ref: <a href=\"https://stackoverflow.com/a/70991572\" target=\"_blank\">https://stackoverflow.com/a/70991572</a></p>\n<p>Cover photo by <a href=\"https://unsplash.com/@onurbinay\" target=\"_blank\">Onur Binay</a> on <a href=\"https://unsplash.com/\" target=\"_blank\">Unsplash</a></p>\n","prev":{"title":"RIPv2 & RIPng Introduction","link":"2022/10/17/ripv2-ripng"},"next":{"title":"Raspberry Pi 4 with Multiple UART Interfaces","link":"2021/12/17/raspberry-pi -4-with-multiple-uart-interface"},"plink":"https://jason19970210.github.io/2022/05/13/step-by-step-start-docker-compose-container-at-boot/","reading_time":"369 words in 2 min"}